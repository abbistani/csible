---

- name: cspace services ansible api client
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    url: false
    base: false
    services: "cspace-services"
    path: "collectionobjects"
    params: "wf_deleted=false"
    method: GET
    user: admin@cspace.lyrasistechnology.org
    password: Administrator
    file: false
    directory: false
    # savefile: false
    verbose: false

  tasks:
    - include: validate.yml

    - name: set url for GET requests
      set_fact:
        url: "{{ base }}/{{ services }}/{{ path }}?{{ params }}"
      when: method == "GET" and not url

    - name: set url for DELETE / POST / PUT requests
      set_fact:
        url: "{{ base }}/{{ services }}/{{ path }}"
      when: method != "GET" and not url

    - include: delete.yml
      when: method == "DELETE" and not file

    # delete resources using a file of resource urls
    - include: delete_from_file.yml
      when: method == "DELETE" and file

    - include: get.yml
      when: method == "GET"

    - include: post.yml
      when: method == "POST" and file

    # import resources from folder of xml files
    - include: post_from_directory.yml
      when: method == "POST" and directory

    - include: put.yml
      when: method == "PUT" and file
